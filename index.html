<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Virtual Board</title>
    <style>
      body {
        margin: 0;
        padding: 0;
        font-family: Arial, sans-serif;
      }

      .header p {
        margin: 0;
        font-size: 16px;
      }

      .logo-left,
      .logo-right {
        width: 100px;
        height: auto;
        position: absolute;
        top: 10px;
      }

      .logo-left {
        left: 10px;
      }

      .logo-right {
        right: 10px;
      }

      #board {
        width: 80%;
        max-width: 800px;
        height: 70vh;
        border: 2px solid black;
        position: relative;
        margin: 0 auto;
        margin-top: 10vh;
      }
      #board canvas {
        cursor: crosshair;
        display: block;
        margin: 0 auto;
        width: 100%;
        height: 100%;
      }

      .btn {
        margin-top: 10px;
        margin-right: 10px;
        padding: 5px 10px;
        background-color: maroon;
        color: white;
        border: none;
        cursor: pointer;
      }

      .btn:hover {
        background-color: black;
      }

      /* Style for file input */
      #fileInput {
        opacity: 0;
        width: 0.1px;
        height: 0.1px;
        position: absolute;
        z-index: -1;
      }

      #fileLabel {
        display: inline-block;
        padding: 8px 16px;
        background-color: maroon;
        color: white;
        border: none;
        cursor: pointer;
      }

      #fileLabel:hover {
        background-color: black;
      }

      input[type="range"] {
        -webkit-appearance: none;
        width: 100%;
        height: 10px;
        background: #000;
        outline: none;
        opacity: 0.7;
        -webkit-transition: 0.2s;
        transition: opacity 0.2s;
      }

      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none;
        appearance: none;
        width: 20px;
        height: 20px;
        background: #800000;
        cursor: pointer;
      }

      input[type="range"]::-moz-range-thumb {
        width: 20px;
        height: 20px;
        background: #800000;
        cursor: pointer;
      }

      input[type="range"]::-webkit-slider-thumb:hover {
        background: #8b0000;
      }

      input[type="range"]:hover {
        opacity: 1;
      }

      /* Media Queries */
      @media only screen and (max-width: 768px) {
        .logo-left,
        .logo-right {
          width: 80px;
        }
      }
    </style>
  </head>
  <body>
    <div class="header">
      <img
        src="https://findvectorlogo.com/wp-content/uploads/2020/04/university-of-montana-vector-logo.png"
        alt="University of Montana Logo"
        class="logo-left"
      />

      <img
        src="https://live.staticflickr.com/65535/51262624119_07fb913283_z.jpg"
        alt="University Logo"
        class="logo-right"
      />
    </div>
    <div id="board">
      <canvas id="canvas"></canvas>
      <button
        id="clearButton"
        class="btn"
        title="Clear All - Click to clear the canvas"
      >
        Clear All
      </button>
      <input type="color" id="colorPicker" value="#000000" />
      <button
        id="eraserButton"
        class="btn"
        title="Eraser - Click to switch to eraser mode"
      >
        Eraser
      </button>
      <button
        id="penButton"
        class="btn"
        title="Pen - Click to switch to pen mode"
      >
        Pen
      </button>
      <button
        id="saveButton"
        class="btn"
        title="Save - Click to save the canvas as an image"
      >
        Save
      </button>
      <label
        id="fileLabel"
        for="fileInput"
        title="Load Image - Click to load an image onto the canvas"
        >Load an image</label
      >
      <input
        type="file"
        id="fileInput"
        accept="image/*"
        title="Image Input - Choose an image to load onto the canvas"
      />
      <button
        id="undoButton"
        class="btn"
        title="Undo - Click to undo the last action"
      >
        Undo
      </button>
      <input
        type="range"
        id="penSizeRange"
        min="1"
        max="20"
        value="2"
        title="Pen Size Range - Adjust the size of your pen"
      />
      <input
        type="color"
        id="backgroundColorPicker"
        value="#ffffff"
        title="Background Color Picker - Choose the canvas background color"
      />
    </div>
    <script>
      document.addEventListener("DOMContentLoaded", function () {
        const board = document.getElementById("board");
        const canvas = document.getElementById("canvas");
        const context = canvas.getContext("2d");
        const clearButton = document.getElementById("clearButton");
        const colorPicker = document.getElementById("colorPicker");
        const eraserButton = document.getElementById("eraserButton");
        const penButton = document.getElementById("penButton");
        const saveButton = document.getElementById("saveButton");
        const fileInput = document.getElementById("fileInput");
        const undoButton = document.getElementById("undoButton");
        const penSizeRange = document.getElementById("penSizeRange");
        const backgroundColorPicker = document.getElementById(
          "backgroundColorPicker"
        );

        canvas.width = board.offsetWidth;
        canvas.height = board.offsetHeight;
        canvas.style.border = "1px solid black";

        let isDrawing = false;
        let isErasing = false;
        let lastX = 0;
        let lastY = 0;
        let history = [];

        function draw(e) {
          if (!isDrawing) return;
          const rect = canvas.getBoundingClientRect();
          const offsetX = e.clientX - rect.left;
          const offsetY = e.clientY - rect.top;
          const color = isErasing ? "#ffffff" : colorPicker.value;
          context.strokeStyle = color;
          context.lineJoin = "round";
          context.lineCap = "round";
          context.lineWidth = isErasing ? 20 : penSizeRange.value;
          context.beginPath();
          context.moveTo(lastX, lastY);
          context.lineTo(offsetX, offsetY);
          context.stroke();
          lastX = offsetX;
          lastY = offsetY;
        }

        canvas.addEventListener("mousedown", (e) => {
          isDrawing = true;
          [lastX, lastY] = [e.offsetX, e.offsetY];
        });

        canvas.addEventListener("touchstart", (e) => {
          isDrawing = true;
          const touch = e.touches[0];
          [lastX, lastY] = [
            touch.pageX - canvas.offsetLeft,
            touch.pageY - canvas.offsetTop,
          ];
        });

        canvas.addEventListener("mousemove", draw);
        canvas.addEventListener("touchmove", (e) => {
          e.preventDefault();
          draw(e.touches[0]);
        });

        canvas.addEventListener("mouseup", () => {
          isDrawing = false;
          saveState();
        });
        canvas.addEventListener("touchend", () => {
          isDrawing = false;
          saveState();
        });

        canvas.addEventListener("mouseout", () => {
          isDrawing = false;
          saveState();
        });

        clearButton.addEventListener("click", () => {
          context.clearRect(0, 0, canvas.width, canvas.height);
          saveState();
        });

        eraserButton.addEventListener("click", () => {
          isErasing = true;
          eraserButton.classList.add("active");
          penButton.classList.remove("active");
        });

        penButton.addEventListener("click", () => {
          isErasing = false;
          penButton.classList.add("active");
          eraserButton.classList.remove("active");
        });

        saveButton.addEventListener("click", () => {
          const savedBackgroundColor = canvas.style.backgroundColor;

          canvas.style.backgroundColor = backgroundColorPicker.value;

          const imageData = canvas.toDataURL();

          canvas.style.backgroundColor = savedBackgroundColor;

          const link = document.createElement("a");
          link.download = "virtual_board.png";
          link.href = imageData;
          link.click();
        });

        fileInput.addEventListener("change", function (e) {
          const file = e.target.files[0];
          const reader = new FileReader();
          reader.onload = function (event) {
            const img = new Image();
            img.onload = function () {
              context.drawImage(img, 0, 0, canvas.width, canvas.height);
              saveState();
            };
            img.src = event.target.result;
          };
          reader.readAsDataURL(file);
        });

        undoButton.addEventListener("click", undo);

        function saveState() {
          history.push(canvas.toDataURL());
        }

        function undo() {
          if (history.length > 1) {
            history.pop();
            const restoredImage = new Image();
            restoredImage.src = history[history.length - 1];
            restoredImage.onload = function () {
              context.clearRect(0, 0, canvas.width, canvas.height);
              context.drawImage(
                restoredImage,
                0,
                0,
                canvas.width,
                canvas.height
              );
            };
          } else if (history.length === 1) {
            context.clearRect(0, 0, canvas.width, canvas.height);
            history.pop();
          }
        }

        penSizeRange.addEventListener("input", () => {
          updatePenSize(penSizeRange.value);
        });

        function updatePenSize(size) {
          context.lineWidth = size;
        }

        backgroundColorPicker.addEventListener("input", () => {
          canvas.style.backgroundColor = backgroundColorPicker.value;
        });
      });
    </script>
  </body>
</html>
